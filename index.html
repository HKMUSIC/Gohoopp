<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Word Guess Whiteboard</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body {
    margin: 0;
    background: #0f0f0f;
    color: white;
    font-family: Arial;
    text-align: center;
}

#toolbar {
    padding: 10px;
    background: #111;
}

button {
    padding: 8px 12px;
    margin: 5px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}

#board {
    background: white;
    touch-action: none;
}
</style>
</head>
<body>

<div id="toolbar">
    <span id="role"></span><br>
    <button id="clear">ðŸ§¹ Clear</button>
</div>

<canvas id="board" width="900" height="500"></canvas>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

const params = new URLSearchParams(window.location.search);
const isExplainer = params.get("role") === "explainer";

document.getElementById("role").innerText =
    isExplainer ? "ðŸŽ¨ You are drawing" : "ðŸ‘€ View only";

const canvas = document.getElementById("board");
const ctx = canvas.getContext("2d");

ctx.lineWidth = 4;
ctx.lineCap = "round";

let drawing = false;

// âŒ VIEWERS CAN'T DRAW
if (!isExplainer) {
    document.getElementById("clear").style.display = "none";
} else {
    canvas.addEventListener("pointerdown", e => {
        drawing = true;
        ctx.beginPath();
        ctx.moveTo(e.offsetX, e.offsetY);
    });

    canvas.addEventListener("pointermove", e => {
        if (!drawing) return;
        ctx.lineTo(e.offsetX, e.offsetY);
        ctx.stroke();
        sendData({
            x: e.offsetX,
            y: e.offsetY,
            draw: true
        });
    });

    canvas.addEventListener("pointerup", () => drawing = false);
}

// ðŸ” SEND DATA TO BOT
function sendData(data) {
    tg.sendData(JSON.stringify(data));
}

// ðŸ§¹ CLEAR BOARD
document.getElementById("clear").onclick = () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    sendData({ clear: true });
};

// ðŸ” RECEIVE DATA FROM BOT
tg.onEvent("message", (event) => {
    try {
        const data = JSON.parse(event.data);
        if (data.clear) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
        if (data.draw) {
            ctx.lineTo(data.x, data.y);
            ctx.stroke();
        }
    } catch {}
});
</script>

</body>
</html>
